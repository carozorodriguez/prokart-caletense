<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ficha del Piloto | PROKART CALETENSE</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;500;700&display=swap" rel="stylesheet">

<style>
:root { --rojo:#e10600; --negro:#111; --gris:#f4f4f4; }
*{box-sizing:border-box}
body{margin:0;font-family:'Oswald',Arial;background:var(--gris)}
header{background:#000;color:#fff;text-align:center;padding:40px 20px}
section{max-width:1000px;margin:auto;padding:40px 20px}
.card{background:#fff;padding:25px;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.1);margin-bottom:30px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px}
img{max-width:100%;border-radius:10px}
h2{border-left:6px solid var(--rojo);padding-left:15px}
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{padding:10px;border-bottom:1px solid #ddd}
th{background:var(--negro);color:#fff}
.btn{display:inline-block;margin-top:15px;padding:12px 18px;background:var(--rojo);color:#fff;text-decoration:none;border-radius:6px}
</style>
</head>

<body>
<header>
  <h1 id="nombrePiloto">Piloto</h1>
  <p id="categoriaPiloto"></p>
</header>

<section>
  <div class="grid">
    <div class="card">
      <img id="fotoPiloto" src="pilotos/default.jpg">
    </div>
    <div class="card">
      <h2>Datos del Piloto</h2>
      <p><strong>Nombre:</strong> <span id="datoNombre"></span></p>
      <p><strong>Categoría:</strong> <span id="datoCategoria"></span></p>
      <p><strong>Total de Puntos:</strong> <span id="datoPuntos"></span></p>
    </div>
  </div>

  <div class="card">
    <h2>Resultados por Fecha</h2>
    <table>
      <thead>
        <tr><th>Fecha</th><th>Puesto</th><th>Puntos</th></tr>
      </thead>
      <tbody id="tablaResultados"></tbody>
    </table>
  </div>

  <a class="btn" href="index.html">⬅ Volver al Campeonato</a>
</section>

<script>
const params=new URLSearchParams(window.location.search);
const piloto=params.get('piloto');
const categoria=params.get('categoria');

const CATEGORIAS={
  "PRE JUNIOR":"https://docs.google.com/spreadsheets/d/e/2PACX-1vQFypnuhKrIq3bwVhehER3JFHbPukGhNGqrAqC2avomKgLPdu6C069biQFU5lAcJ3_6kt7Jntl4dre0/pub?gid=0&single=true&output=csv",
  "JUNIOR":"https://docs.google.com/spreadsheets/d/e/2PACX-1vQFypnuhKrIq3bwVhehER3JFHbPukGhNGqrAqC2avomKgLPdu6C069biQFU5lAcJ3_6kt7Jntl4dre0/pub?gid=1173158505&single=true&output=csv",
  "110 Cajeros":"https://docs.google.com/spreadsheets/d/e/2PACX-1vQFypnuhKrIq3bwVhehER3JFHbPukGhNGqrAqC2avomKgLPdu6C069biQFU5lAcJ3_6kt7Jntl4dre0/pub?gid=796482582&single=true&output=csv",
  "200 Master":"https://docs.google.com/spreadsheets/d/e/2PACX-1vQFypnuhKrIq3bwVhehER3JFHbPukGhNGqrAqC2avomKgLPdu6C069biQFU5lAcJ3_6kt7Jntl4dre0/pub?gid=2021979125&single=true&output=csv",
  "200 STD":"https://docs.google.com/spreadsheets/d/e/2PACX-1vQFypnuhKrIq3bwVhehER3JFHbPukGhNGqrAqC2avomKgLPdu6C069biQFU5lAcJ3_6kt7Jntl4dre0/pub?gid=660182728&single=true&output=csv"
};

if(!piloto || !categoria){
  alert('Piloto no encontrado');
}

// Cargar datos
fetch(CATEGORIAS[categoria])
  .then(r=>r.text())
  .then(text=>{
    const filas=text.trim().split('\n').slice(1);
    const datos=filas.map(f=>{
      const c=f.split(',').map(v=>v.replace(/"/g,''));
      return {fecha:c[0],piloto:c[1],puesto:c[2],puntos:+c[3]};
    }).filter(d=>d.piloto===piloto);

    document.getElementById('nombrePiloto').textContent=piloto;
    document.getElementById('categoriaPiloto').textContent=categoria;
    document.getElementById('datoNombre').textContent=piloto;
    document.getElementById('datoCategoria').textContent=categoria;

    const total=datos.reduce((a,b)=>a+b.puntos,0);
    document.getElementById('datoPuntos').textContent=total;

    const img=document.getElementById('fotoPiloto');
    img.src=`pilotos/${piloto.replaceAll(' ','_')}.jpg`;
    img.onerror=()=>img.src='pilotos/default.jpg';

    const tb=document.getElementById('tablaResultados');
    datos.forEach(d=>{
      tb.innerHTML+=`<tr><td>${d.fecha}</td><td>${d.puesto}</td><td>${d.puntos}</td></tr>`;
    });
  });
</script>
</body>
</html>
